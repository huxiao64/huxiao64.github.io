<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         WeiLi
    -->
    <meta charset="utf-8" />
    <title>十分钟了解分布式计算:Spark | WeiLi</title>
    <meta name="author" content="BieYuu" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="WeiLi's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">WeiLi</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/silviaazaaza/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/spark" title="十分钟了解分布式计算:Spark">十分钟了解分布式计算:Spark</a></h1>
        <p class="entry-date">2014-06-13</p>
        <h4>Spark原型论文</h4>

<p>Zaharia, Matei, et al. "<a href="https://www.usenix.org/conference/nsdi12/technical-sessions/presentation/zaharia">Resilient Distributed Datasets: A Fault-Tolerant Abstraction for In-Memory Cluster Computing</a>" Proceedings of the 9th USENIX conference on Networked Systems Design and Implementation. USENIX Association, 2012.
[<a href="https://www.usenix.org/system/files/conference/nsdi12/nsdi12-final138.pdf">PDF</a>] [<a href="https://www.usenix.org/sites/default/files/conference/protected-files/nsdi_zaharia.pdf">PPT</a>][<a href="http://blog.sciencenet.cn/home.php?mod=space&amp;uid=425672&amp;do=blog&amp;id=520947">中文翻译</a>]</p>

<p>论文提出了<strong>弹性分布式数据集（RDD，Resilient Distributed Datasets）</strong>，这是一种分布式的内存抽象，允许在大型集群上执行基于内存的计算（In-Memory Computing），与此同时还保持了MapReduce等数据流模型的容错特性。</p>

<p>现有的数据流系统对两种应用的处理并不高效：一是<strong>迭代式算法</strong>，这在图应用和机器学习领域很常见；二是<strong>交互式数据挖掘工具</strong>。这两种情况下，将数据保存在内存中能够极大地提高性能。为了有效地实现<strong>容错</strong>，RDD提供了一种高度受限的共享内存，即RDD是<strong>只读</strong>的，并且<strong>只能通过其他RDD上的批量操作来创建</strong>。尽管如此，RDD仍然足以表示很多类型的计算，包括MapReduce和专用的迭代编程模型（如Pregel）等。论文中实现的RDD在迭代计算方面比Hadoop快二十多倍，同时还可以在5-7秒的延时内交互式地查询1TB的数据集。</p>

<p>第一作者<a href="http://people.csail.mit.edu/matei/">Matei Zaharia</a>是<a href="http://amplab.cs.berkeley.edu/">UC Berkeley AMP Lab</a>的PHD，MIT讲师，Spark母公司Databricks的创始人。
<img src="http://images.cnitblog.com/blog/331825/201406/131913142027574.jpg" alt="" /></p>

<h4>背景</h4>

<ol>
<li>迭代式算法的特点在于，它是给定问题y=f(x)，已知x和y，想要得到的是f的参数。所以需要从一个参数的initial值开始，扫描很多遍数据，比如说迭代100次，去逼近参数（类似数值分析中牛顿迭代法解方程的做法）。<img src="http://images.cnitblog.com/blog/331825/201406/131913410923427.jpg" alt="" /></li>
<li>Hadoop对迭代式问题没有很好的解决，Disk－IO花费时间太多。Spark针对复杂分布式计算任务中，HDFS的反复读写特别耗时的问题，给常用数据一种共享的状态（内存的读写是TB级别的），特别适合交互式数据分析任务（对时间忍受很差），以及复杂的图算法(pagerank)<img src="http://images.cnitblog.com/blog/331825/201406/131914056551722.jpg" alt="" /></li>
</ol>


<h4>内存上的有效容错</h4>

<ol>
<li>RDD是一种抽象数据集，中间数据不用的时候不需要具象化，对RDD使用persist()/cached()函数可以使其持久化。</li>
<li>主流的容错方法有两种 1)logging（记录细粒度update）2)快照（缺点就是代价太大）。</li>
<li>Hadoop采用数据持久化的方式进行容错，HDFS每次读写都要做replica，代价是很大的。</li>
<li>对于Spark，内存是易失的，某个机器down掉了，内存中的RDD就没了。因此我们需要知道如果一个点failed，这个点的数据从哪里来。其采用记录RDD的血统（lineage）这种方式来进行容错，可以根据lineage来重新计算缺少的部分。lineage有五点信息，包括数据在哪，操作，优先使用什么，hash策略等。</li>
<li>为了做容错，RDD这种数据结构有两种限制：1) immutable（只需记录lineage就可以恢复）2) 是一种paritioned collections of record，只能从coarse-grained deterministic transformations（相当于从A到B只有一种走法，不能是随机的）得到。<img src="http://images.cnitblog.com/blog/331825/201406/131915180772497.jpg" alt="" /></li>
</ol>


<h4>和内存数据库的区别</h4>

<ol>
<li>数据库是细粒度的，每一条record的价值都很大，通常不需要统计群体的情况</li>
<li>spark是粗粒度的，是“apply same operation to many items”，一次操作中大批数据都要参与进来。对于大数据来说任意一条数据是没有意义的，群体特征才有意义。</li>
<li>检索任务（细粒度）涉及到剪枝，分析任务（粗粒度）涉及到全盘扫描或下采样。</li>
<li>RAMCloud适合transaction事务级别（内存数据库Redis），而Spark适合做batch批处理</li>
</ol>


<h4>Spark实例：PageRank</h4>

<ol>
<li>Spark可以方便地做Join操作（link和rank两张表)，而join的容错恢复是比较难的，不是narrow dependence，而是wide dependence<img src="http://images.cnitblog.com/blog/331825/201406/131917011557505.jpg" alt="" /><img src="http://images.cnitblog.com/blog/331825/201406/131918217491618.jpg" alt="" /><img src="http://images.cnitblog.com/blog/331825/201406/131918336248822.jpg" alt="" /></li>
<li>Spark对用户提供了三种interface: 1) RDD 2)RDD的操作 3)RDD切分的控制。主要有两种不同类型的Flow: Data Flow(对数据进行改变，例如transformation and actions)和Control Flow(并不对数据进行改变，partitioning and persistence)<img src="http://images.cnitblog.com/blog/331825/201406/131916241084890.jpg" alt="" /><img src="http://images.cnitblog.com/blog/331825/201406/131919467804739.jpg" alt="" /></li>
</ol>


       
    </div>

    <div class="sidenav">
        <iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=75&fansRow=2&ptype=1&speed=0&skin=5&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=1665709880&verifier=cb2e2bea&dpc=1"></iframe>
    </div>

    <div class="sidenav">
        <h2>Tech</h2>
        <ul class="artical-list">
        
            <li><a href="/spark%20copy">十分钟了解分布式计算:GraphLab</a></li>
        
            <li><a href="/spark">十分钟了解分布式计算:Spark</a></li>
        
            <li><a href="/petuum">十分钟了解分布式计算:Petuum</a></li>
        
            <li><a href="/graphlab">十分钟了解分布式计算:GraphLab</a></li>
        
            <li><a href="/word2vec">文本深度表示模型Word2Vec</a></li>
        
        </ul>

        <h2>Life</h2>
        <ul class="artical-list">
        
        </ul>

        <h2>About</h2>
        <ul class="artical-list">
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>

<!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="请将此处替换成文章在你的站点中的ID" data-title="请替换成文章的标题" data-url="请替换成文章的网址"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"wli12"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
<!-- 多说公共JS代码 end -->


    <!--*********************************************************-->
    <!--****** 宝贝儿，看见这个时候，删掉下面的统计代码哦~ ******-->
    <!--************* 再推荐下我的第一篇博客哦~~ ****************-->
    <!--*********************************************************-->

    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })
    </script>
</body>
</html>
