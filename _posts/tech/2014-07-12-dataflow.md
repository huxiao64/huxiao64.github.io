---
layout: post
title: 十分钟了解分布式计算:Google Dataflow
description: Google声称内部已经抛弃Map-reduce几年了，并在今年的Google IO大会高调发布Cloud Dataflow系统。来看看在这个新框架下如何进行分布式计算吧。
category: tech
---
本文的内容主要基于官方资料

[Sneak peek: Google Cloud Dataflow, a Cloud-native data processing service](http://googlecloudplatform.blogspot.com/2014/06/sneak-peek-google-cloud-dataflow-a-cloud-native-data-processing-service.html)

[Google I/O 2014 - The dawn of "Fast Data"](http://www.youtube.com/watch?v=TnLiEWglqHk)(国内用户[下载](http://www.clipconverter.cc/download/-zyrPs6V/108992264/))

####介绍
Dataflow集成了许多内部技术，如Flume和MillWheel，这一版对外发布提供Java接口（其实Flume本身是提供Java/C++/Python多种接口的）

相比map-reduce模型，Dataflow有几个亮点：

1. 可以构建复杂的pipeline
2. 不需配置和管理MapReduce集群。，自动进行代码优化和资源调度，使得用户可以只关注于业务逻辑
![](/images/dataflow/dataflow.png)
3. 支持从Batch到Streaming模式的无缝切换:
假设我们要实现一个hashtags自动补全的功能
![](/images/dataflow/goal.png)
数据流
![](/images/dataflow/pipeline0.png)
对应的代码为
![](/images/dataflow/pipeline1.png)
这是批处理的做法
![](/images/dataflow/batch.png)
转化为streaming做法只需改动数据源，还可以额外添加一行设置数据window的操作
![](/images/dataflow/streaming.png)
4. Dashboard:
还可以在developer console中了解任务执行的情况，每个流程框基本对应着一行代码
![](/images/dataflow/dashboard.png)
5. 生态系统:
BigQuery作为存储系统是Dataflow的一个补充，经过Dataflow清洗和处理过的数据，可以在BigQuery中存下来，同时Dataflow也可以读取BigQuery以进行表连接等操作。如果想在Dataflow上使用一些开源资源（比如说Spark中的机器学习库），也是很方便的
![](/images/dataflow/eco.png)

[Google Cloud Platform](https://developers.google.com/cloud/)

####比较
1. 可以构建复杂的pipeline，自动优化和调度，Dataflow乍一听感觉非常像Hadoop上的[Cascading](http://www.cascading.org/)(Java)/[Scalding](https://github.com/twitter/scalding/)(Scala)
2. 而将批处理和流处理无缝连接的思想又听起来很像把Scalding和[Strom](https://github.com/nathanmarz/storm)无缝连接起来的twitter [summingbird](https://github.com/twitter/summingbird)(Scala).
3. [Spark](https://spark.incubator.apache.org/)也有可以构建复杂的pipeline做一代码优化和任务调度的好处，并且Scala接口使得语法更简洁，但目前还需要程序员来配置资源分配。不过Dataflow并没有提内存计算的事儿，这一点跟Spark有着本质的区别，它把Spark作为一种很好的Open Source补充。

####链接
[Google Announces Cloud Dataflow Beta at Google I/O](http://www.infoq.com/news/2014/06/google-io-cloud-dataflow)

[Google Cloud Dataflow 简单理解](http://weibo.com/p/1001603730758610079518)

[Google Launches Cloud Dataflow, A Managed Data Processing Service](http://techcrunch.com/2014/06/25/google-launches-cloud-dataflow-a-managed-data-processing-service/)

[Mapreduce successor google cloud dataflow is a game changer for hadoop thunder](http://cloudtimes.org/2014/07/07/mapreduce-successor-google-cloud-dataflow-is-a-game-changer-for-hadoop-thunder/)

####论文
[FlumeJava: Easy, Efficient Data-Parallel Pipelines,PLDI,2010](http://pages.cs.wisc.edu/~akella/CS838/F12/838-CloudPapers/FlumeJava.pdf)

[MillWheel: Fault-Tolerant Stream Processing at Internet Scale,Very Large Data Bases (2013), pp. 734-746](http://research.google.com/pubs/pub41378.html)